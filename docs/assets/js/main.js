"use strict";const inputSearch=document.querySelector(".js-input"),btnSearch=document.querySelector(".js-btn-search"),btnReset=document.querySelector(".js-btn-reset"),listSearch=document.querySelector(".js-list-search"),listFavourites=document.querySelector(".js-list-favourites"),btnResetFavourites=document.querySelector(".js-btn-reset-favourites");let series=[],favourites=[];const dataLS=JSON.parse(localStorage.getItem("favourites")),getDataAPI=e=>{if(""!==e)fetch("https://api.jikan.moe/v4/anime?q="+e).then(e=>e.json()).then(e=>{series=e.data,renderSeriesSearch()});else{let e="";listSearch.innerHTML=e}},renderSeriesSearch=()=>{let e="",t="";for(const s of series){t=-1!==favourites.findIndex(e=>e.mal_id===s.mal_id)?"--favourite":"--search",e+=`<li class="js-serie serie serie${t}" id="${s.mal_id}">`,e+=`<h2 class="serie__title">${s.title.substring(0,29)}</h2>`,"https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png"===s.images.jpg.image_url?(s.images.jpg.image_url="https://via.placeholder.com/200/a52a2a/ffffff/?text=NOT+IMAGE",e+=`<img class="serie__img" src="${s.images.jpg.image_url}" />`):e+=`<img class="serie__img" src="${s.images.jpg.image_url}" />`,e+='<div class="serie__button--container"><button class="serie__button"><i class="fa-solid fa-heart-circle-plus serie__button--icon-plus fa-lg"></i></button>',e+='<button class="serie__button"><i class="fa-solid fa-heart-circle-xmark serie__button--icon-remove fa-lg"></i></button>',e+='<button class="serie__button"><i class="fa-solid fa-heart serie__button--icon fa-lg"></i></button></div>',e+="</li>"}listSearch.innerHTML=e,listenerSerie()},renderSeriesFavourites=()=>{let e="";for(const t of favourites)e+=`<li class="js-serie favourite" id="${t.mal_id}">`,e+=`<h2 class="favourite__title">${t.title.substring(0,29)}</h2>`,"https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png"===t.images.jpg.image_url?(t.images.jpg.image_url="https://via.placeholder.com/200/a52a2a/ffffff/?text=NOT+IMAGE",e+=`<img class="favourite__img" src="${t.images.jpg.image_url}" />`):e+=`<img class="favourite__img" src="${t.images.jpg.image_url}" />`,e+='<div class="favourite__button--container">',e+='<button class="favourite__button"><i class="fa-solid fa-heart-circle-xmark favourite__button--icon-remove fa-lg"></i></button>',e+='<button class="favourite__button"><i class="fa-solid fa-heart favourite__button--icon fa-lg"></i></button></div>',e+="</li>";listFavourites.innerHTML=e,resetFavourites(e),localStorage.setItem("favourites",JSON.stringify(favourites)),renderSeriesSearch()},handleClick=e=>{const t=parseInt(e.currentTarget.id),s=series.find(e=>e.mal_id===t),i=favourites.findIndex(e=>e.mal_id===t);-1===i?favourites.push(s):favourites.splice(i,1),renderSeriesFavourites()};function listenerSerie(){const e=document.querySelectorAll(".js-serie");for(const t of e)t.addEventListener("click",handleClick)}const resetFavourites=e=>{""!==e?btnResetFavourites.classList.remove("hidden"):btnResetFavourites.classList.add("hidden")},handleResetFavourites=()=>{favourites=[];renderSeriesFavourites(),localStorage.clear("favourites"),resetFavourites("");let e=inputSearch.value;getDataAPI(e)};btnResetFavourites.addEventListener("click",handleResetFavourites);const handleReset=()=>{let e=inputSearch.value;e="",getDataAPI("")};btnReset.addEventListener("click",handleReset);const handleSearch=e=>{e.preventDefault();const t=inputSearch.value.toLowerCase();getDataAPI(t)};function onLoad(){null!==dataLS?(favourites=dataLS,renderSeriesFavourites()):listfavourites.innerHTML=""}btnSearch.addEventListener("click",handleSearch),inputSearch.addEventListener("keyup",handleSearch),onLoad();